<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>IRIS 58 - Poste de Contrôle Central</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>

    <style>
        :root {
            --bg-dark: #050a15;
            --sidebar-bg: #0a192f;
            --accent: #00d2ff;
            --danger: #ff4d4d;
        }

        body { margin: 0; padding: 0; background: var(--bg-dark); color: white; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; overflow: hidden; }

        /* PANNEAU LATÉRAL */
        #sidebar {
            width: 350px;
            background: var(--sidebar-bg);
            border-right: 2px solid #1a2a44;
            display: flex;
            flex-direction: column;
        }

        .header-pcc { padding: 20px; border-bottom: 1px solid #1a2a44; background: #0d1b2a; }
        .header-pcc h1 { margin: 0; font-size: 1.5em; color: var(--accent); }

        #bus-list { flex: 1; overflow-y: auto; padding: 15px; }

        .bus-item {
            background: #16243a;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid var(--accent);
            transition: 0.3s;
        }

        .bus-item.warning { border-left-color: var(--danger); animation: pulse 1.5s infinite; }

        /* CARTE */
        #map { flex: 1; background: #0b1424; }

        /* ALERTES OVERLAY */
        #alert-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 0, 0, 0.3); display: none;
            justify-content: center; align-items: center; z-index: 9999;
            pointer-events: none; border: 10px solid var(--danger);
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="alert-overlay">
        <h1 style="font-size: 4em; text-shadow: 0 0 20px black;">⚠️ ALERTE INCIDENT L58 ⚠️</h1>
    </div>

    <aside id="sidebar">
        <div class="header-pcc">
            <h1>IRIS 58 - RÉGULATION</h1>
            <div id="status-pcc" style="font-size: 0.8em; color: #00c853;">● SYSTÈME EN LIGNE</div>
        </div>
        <div id="bus-list">
            <p style="color: #8892b0; text-align: center;">Aucun bus en service...</p>
        </div>
    </aside>

    <div id="map"></div>

    <script>
        // Config Carte (Centrée sur la ligne 58 Paris)
        const map = L.map('map').setView([48.835, 2.325], 13);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

        const markers = {};
        const
